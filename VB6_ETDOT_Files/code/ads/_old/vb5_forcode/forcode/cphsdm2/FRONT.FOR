CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C     MODULE NAME: CPHSDM2
C
C     DESCRIPTION: THIS PROGRAM USES THE PROCEDURE DESCRIBED IN A
C         PAPER BY HAND, ET AL. (REFER TO CPHSDM.FOR FOR REFRENCE)
C         TO CALCULATE THE EMPTY BED CONTACT TIME (EBCT) OF THE
C         MASS TRANSFER ZONE WITHIN THE ADSORBER AND TO CALCULATE
C         THE MASS TRANSFER PROFILE.
C
C     PLATFORM: MICROSOFT FORTRAN POWERSTATION V4.0
C
C     HISTORY:
C         1998-SEP-02 - OMAN - CONVERTED DLL FORTRAN CODE FOR USE AS
C                              AN EXE CONNECTED TO THE ADDESIGNS FRONT-END.
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C                                                                              *
C234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567
C-----789012345678901234567890123456789012345678901234567890123456789012CCCCCCCC-----------------

      PROGRAM CPHSDM2
      IMPLICIT NONE
C
C------ PARAMETERS PASSED TO CALCULATION MODULE.
C
      DOUBLE PRECISION Bed(1:6)
      DOUBLE PRECISION Compo(1:4)
      DOUBLE PRECISION Kine(1:2)
      DOUBLE PRECISION TACT(1:210)
      DOUBLE PRECISION CC(1:210)
      DOUBLE PRECISION PARAM(1:7)
      INTEGER*2 ER_FLAG
C
C------ LOCAL VARIABLES.
C
      CHARACTER*200 FN_IN_MAIN
      CHARACTER*200 FN_OUT_SUCCESSFLAG
      CHARACTER*200 FN_OUT_MAIN
      DOUBLE PRECISION VERSION_CHECK
      DOUBLE PRECISION EOFTESTMARKER
      INTEGER I
C
C------ COMMON VARIABLES.
C
      INCLUDE 'COMMON.FI'
C
C------ START OF CODE.
C
C
C------ READ PATH FILE.
C
      OPEN(UNIT=11,FILE='CPHSDM1.IN',STATUS='OLD')
      READ (11,*) FN_IN_MAIN
      READ (11,*) FN_OUT_SUCCESSFLAG
      READ (11,*) FN_OUT_MAIN
	CLOSE(11)
C
C------ READ MAIN INPUT FILE.
C
      OPEN(UNIT=11,FILE=FN_IN_MAIN,STATUS='OLD')
      READ (11,*) VERSION_CHECK
      IF (DABS((VERSION_CHECK+0.000001D0)/
     &    1.00D0-1.00D0).LE.0.001D0) THEN
C
C------ VERSION CHECK SUCCESSFUL; DO NOTHING.
C      
      ELSE
        PRINT *, 'INVALID INPUT FILE FORMAT (VERSION CODE).'
        CALL TERMINATE_MODEL
      ENDIF
      DO I=1,6
        READ (11,*) Bed(I)
      ENDDO
      DO I=1,4
        READ (11,*) Compo(I)
      ENDDO
      DO I=1,2
        READ (11,*) Kine(I)
      ENDDO
      READ (11,*) EOFTESTMARKER
      IF (DABS((EOFTESTMARKER+0.000001D0)/
     &    123456.0D0-1.0D0).LE.0.001D0) THEN
C
C------ EOF TEST MARKER CHECK SUCCESSFUL; DO NOTHING.
C      
      ELSE
        PRINT *, 'INVALID INPUT FILE FORMAT (EOF MARKER).'
        CALL TERMINATE_MODEL
      ENDIF
      CLOSE(11)
C
C------ CALL THE CALCULATION ROUTINE.
C      
      CALL CPM(Bed,Compo,Kine,TACT,CC,PARAM,ER_FLAG)
C
C------ WRITE SUCCESS FLAG OUTPUT FILE.
C
      OPEN(UNIT=12,FILE=FN_OUT_SUCCESSFLAG)
      WRITE(12,*) 'ER_FLAG, ERROR FLAG FOR CPHSDM MODEL:'
      WRITE(12,*) ER_FLAG
      CLOSE(12)
C
C------ WRITE MAIN OUTPUT FILE.
C
      OPEN(UNIT=12,FILE=FN_OUT_MAIN)
      WRITE(12,*) 'TACT, TIME DATA, days'
      DO I=1,210
        WRITE(12,*) TACT(I)
      ENDDO
      WRITE(12,*) 'CC, C/Co CONCENTRATION DATA, dimensionless'
      DO I=1,210
        WRITE(12,*) CC(I)
      ENDDO
      WRITE(12,*) 'PARAM, VARIOUS PARAMETERS, various units'
      DO I=1,7
        WRITE(12,*) PARAM(I)
      ENDDO
      WRITE(12,*) 'EOFTESTMARKER:'
      WRITE(12,*) 123456.0D0
      CLOSE(12)
      END


      SUBROUTINE TERMINATE_MODEL
      IMPLICIT NONE
CC------ COMMON VARIABLES.
C      INCLUDE 'COMMON.FI'
      PAUSE 'Press Enter to terminate model.'
      STOP
      RETURN
	END

